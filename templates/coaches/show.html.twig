{% extends 'base.html.twig' %}

{% block title %} Coach: {{ coach.firstName }} {{ coach.lastName }} {% endblock %}

{% block body %}
<div class="container">
    <div class="row">
        <div class="col-12">
            <h2 class="my-4">Coach</h2>
            <div style="box-shadow: 2px 3px 9px 4px rgba(0,0,0,0.04);">
                <div class="q-container-show p-4">
                    <div class="row">
                        <div class="col-2 text-center">
                            <img src="{{asset ('images/img_avatar3.png')}}" width="100" height="100">
                        </div>
                        <div class="col">
                            <h1 class="q-title-show">{{ coach.firstName }} {{ coach.lastName }} {% if (reviewavg.avg | round(1, 'floor')) == 0 %}
                            {% else %}
                            - {{ reviewavg.avg | round(1, 'floor') }}
                            {% endif %}</h1>
                            {% if reviewitems is empty %}
                            No reviews
                            {% else %}
                            Review: {{ (reviewitems|map(r => r.stars)|reduce((carry, v) => carry + v) / reviewitems|length) | round(1, 'floor')}}
                            {% endif %}
                            <div class="q-display p-3">
                                <i class="fa fa-quote-left mr-3"></i>
                                <p class="d-inline">{{ coach.achievements }}</p>
                                
                                {% for game in coach.games %}
                                <p class="pt-4"><strong>{{ game.name }} </strong></p>
                                {% endfor %}
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <ul class="list-unstyled">
        {% for product in products %}
            <li class="mb-4">
                <div class="d-flex justify-content-center">
                    <div class="mr-2 pt-2">
                        <img src="{{asset ('images/tisha.png')}}" width="50" height="50">
                    </div>
                    <div class="mr-3 pt-2">
                       <p>{{ product.type }}</p>Description - {{ product.description }} : {{ product.price }}$
                       <p>{{ product.game.name }}
                    </div>
                    {% if is_granted("ROLE_COACH") and user.id == app.user.id %}
                    <div class="flex-fill pt-2" style="min-width: 90px;">
                    <form action="{{ path('product_delete', { id: product.id }) }}" method="POST" >
                        <input type="hidden" name="_method" value="DELETE"/>
                        <button type="submit" class="btn btn-outline-danger btn-sm"><i class="fas fa-trash-alt"></i></button>
                    </form>
                            <a class="btn btn-outline-primary btn-sm" href="{{ path ('product_update', { id: product.id }) }}">
                            <i class="fas fa-pen"></i>
                            </a>
                    </div>
                    {% endif %}
                </div>
            </li>
        {% endfor %}
    </ul>
    {% if is_granted("ROLE_COACH") and user.id == app.user.id %}
    <p>
        <a class="btn btn-primary" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
        Create product
        </a>
    </p>
    <div class="collapse" id="collapseExample">
        <div class="card card-body">
            {{ form(form) }}
        </div>
    </div>
    <a href="{{ path('ch_update', {id: coach.id})}}" class="btn btn-secondary mb-3"> Coach update </a>
    <form action="{{ path('remove_id', { id: coach.id }) }}" method="POST" >
        <input type="hidden" name="_method" value="DELETE"/>
        <button type="submit" class="btn btn-danger">Remove coach</button>
    </form>
    {% endif %}

    {% if is_granted("ROLE_COACH") %}
    {% else %}
    <div class="mt-5">
        <h5> Review </h5>
        <div class="card card-body">
            {{ form_start(reviewform) }}
            {{ form_row(reviewform.stars) }}
            {{ form_row(reviewform.description, {'attr': {'class': 'form-control'}}) }}
            <div class="row">
                <div class="col">
            {{ form_widget(reviewform.save, {'attr': {'class': 'btn btn-primary'}}) }}
                </div>
            </div class="row">
            {{ form_end(reviewform) }}
        </div>
    </div>
    {% endif %}
    <div class="mt-5">
        {% for reviewitem in reviewitems %}
            <div class="card card-body"
                <li>
                <h5> Stars: {{ reviewitem.stars }} </h5>
                    <p> Description: {{ reviewitem.description }} </p>
                </li>
            </div>
        {% endfor %}
    </div>

</div>

{% endblock %}